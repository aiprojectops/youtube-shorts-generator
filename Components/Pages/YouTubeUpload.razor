@page "/youtube-upload"
@rendermode InteractiveServer
@using YouTubeShortsWebApp
@using YouTubeShortsWebApp.Services
@inject IJSRuntime JSRuntime
@inject UploadScheduleService SchedulerService
@inject YouTubeUploadService YouTubeService

<PageTitle>YouTube ì—…ë¡œë“œ</PageTitle>

<h1>YouTube ì—…ë¡œë“œ</h1>

<div class="container">
    <div class="row">
        <div class="col-md-8">

            <!-- íŒŒì¼ ì„ íƒ ì„¹ì…˜ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>ë¹„ë””ì˜¤ íŒŒì¼ ì„ íƒ</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label"><strong>ë¹„ë””ì˜¤ íŒŒì¼ë“¤:</strong></label>
                        <InputFile OnChange="HandleFileSelection" accept="video/*" multiple class="form-control" disabled="@isUploading" />
                        <div class="form-text">í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš” (ê°ê° ìµœëŒ€ 2GB)</div>
                    </div>

                    @if (selectedFiles.Count > 0)
                    {
                        <div class="alert alert-info">
                            <strong>ì„ íƒëœ íŒŒì¼:</strong> @selectedFiles.Count ê°œ
                            <ul class="mb-0 mt-2">
                                @foreach (var file in selectedFiles.Take(5))
                                {
                                    <li>@file.Name (@VideoGenerationService.FormatFileSize(file.Size))</li>
                                }
                                @if (selectedFiles.Count > 5)
                                {
                                    <li>... ì™¸ @(selectedFiles.Count - 5)ê°œ ë”</li>
                                }
                            </ul>
                        </div>
                    }
                </div>
            </div>

            <!-- YouTube ì¸ì¦ ì„¹ì…˜ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>YouTube ê³„ì • ì—°ë™</h4>
                </div>
                <div class="card-body">
                    @if (YouTubeService.CurrentAccount == null)
                    {
                        <button type="button" class="btn btn-danger" @onclick="AuthenticateYouTube" disabled="@(isAuthenticating || isUploading)">
                            <i class="bi bi-youtube"></i> YouTube ê³„ì • ì—°ë™í•˜ê¸°
                        </button>
                        <div class="form-text mt-2">ì—…ë¡œë“œí•˜ë ¤ë©´ ë¨¼ì € YouTube ê³„ì •ì„ ì—°ë™í•´ì•¼ í•©ë‹ˆë‹¤.</div>
                    }
                    else
                    {
                        <div class="alert alert-success">
                            <h6>âœ… ì—°ë™ëœ ê³„ì •</h6>
                            <p class="mb-1"><strong>ì±„ë„:</strong> @YouTubeService.CurrentAccount.ChannelTitle</p>
                            <p class="mb-1"><strong>êµ¬ë…ì:</strong> @YouTubeService.CurrentAccount.SubscriberCount.ToString("N0") ëª…</p>
                            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" @onclick="SwitchAccount" disabled="@isUploading">
                                ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì „í™˜
                            </button>
                        </div>
                    }
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ì„¤ì • ì„¹ì…˜ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>ì—…ë¡œë“œ ì •ë³´ ì„¤ì •</h4>
                </div>
                <div class="card-body">
                    <!-- ëœë¤ ì—…ë¡œë“œ ì •ë³´ ì‚¬ìš© ì˜µì…˜ -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" @bind="useRandomUploadInfo" 
                                   @bind:after="OnRandomUploadInfoChanged" id="useRandomUploadInfo" disabled="@isUploading">
                            <label class="form-check-label" for="useRandomUploadInfo">
                                <strong>ëœë¤ ì—…ë¡œë“œ ì •ë³´ ì‚¬ìš© (CSV)</strong>
                            </label>
                        </div>
                    </div>

                    @if (useRandomUploadInfo)
                    {
                        <!-- CSV ì—…ë¡œë“œ -->
                        <div class="mb-3">
                            <label class="form-label">ì—…ë¡œë“œ ì •ë³´ CSV íŒŒì¼:</label>
                            <InputFile OnChange="HandleUploadInfoCsvSelection" accept=".csv" class="form-control" disabled="@isUploading" />
                            <div class="form-text">
                                CSV í˜•ì‹: ì œëª©,ì„¤ëª…,íƒœê·¸ (ê° ì¤„ë§ˆë‹¤ í•˜ë‚˜ì˜ ì—…ë¡œë“œ ì •ë³´)
                            </div>
                            
                            @if (uploadInfoCsvList.Count > 0)
                            {
                                <div class="alert alert-success mt-2">
                                    âœ… @uploadInfoCsvList.Count ê°œ ì—…ë¡œë“œ ì •ë³´ ë¡œë“œë¨
                                    <button type="button" class="btn btn-sm btn-primary ms-2" @onclick="() => showUploadInfoCsvPreview = true">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <!-- ê¸°ë³¸ ì—…ë¡œë“œ ì •ë³´ ì…ë ¥ -->
                        <div class="mb-3">
                            <label class="form-label"><strong>ì œëª©:</strong></label>
                            <input type="text" class="form-control" @bind="uploadOptions.TitleTemplate" 
                                   placeholder="ì˜ìƒ ì œëª© ì…ë ¥..." disabled="@isUploading" />
                            <div class="form-text">ì—¬ëŸ¬ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë²ˆí˜¸ê°€ ì¶”ê°€ë©ë‹ˆë‹¤</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>ì„¤ëª…:</strong></label>
                            <textarea class="form-control" rows="3" @bind="uploadOptions.Description" 
                                      placeholder="ì˜ìƒ ì„¤ëª… ì…ë ¥..." disabled="@isUploading"></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„):</strong></label>
                            <input type="text" class="form-control" @bind="uploadOptions.Tags" 
                                   placeholder="tag1, tag2, tag3" disabled="@isUploading" />
                        </div>
                    }

                    <!-- ê³µê°œ ì„¤ì • -->
                    <div class="mb-3">
                        <label class="form-label"><strong>ê³µê°œ ì„¤ì •:</strong></label>
                        <select class="form-select" @bind="uploadOptions.PrivacySetting" disabled="@isUploading">
                            <option value="ğŸ”’ ë¹„ê³µê°œ">ğŸ”’ ë¹„ê³µê°œ</option>
                            <option value="ğŸ”— ë§í¬ ê³µìœ ">ğŸ”— ë§í¬ ê³µìœ </option>
                            <option value="ğŸŒ ê³µê°œ">ğŸŒ ê³µê°œ</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ë°©ì‹ ì„ íƒ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>ì—…ë¡œë“œ ë°©ì‹</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="uploadMode" id="immediateUpload"
                                   @onchange="() => isScheduleUpload = false" checked="@(!isScheduleUpload)" disabled="@isUploading">
                            <label class="form-check-label" for="immediateUpload">
                                <strong>ì¦‰ì‹œ ì—…ë¡œë“œ</strong> - ì„ íƒí•œ íŒŒì¼ë“¤ì„ ì§€ê¸ˆ ë°”ë¡œ ì—…ë¡œë“œ
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="uploadMode" id="scheduledUpload"
                                   @onchange="() => isScheduleUpload = true" checked="@isScheduleUpload" disabled="@isUploading">
                            <label class="form-check-label" for="scheduledUpload">
                                <strong>ìŠ¤ì¼€ì¤„ ì—…ë¡œë“œ</strong> - ì§€ì •í•œ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì—…ë¡œë“œ
                            </label>
                        </div>
                    </div>

                    @if (isScheduleUpload)
                    {
                        <!-- ìŠ¤ì¼€ì¤„ ì„¤ì • -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">ë¶„ì‚° ì‹œê°„: @scheduleSettings.Hours ì‹œê°„</label>
                                <input type="range" class="form-range" min="0.5" max="24" step="0.5" 
                                       @bind="scheduleSettings.Hours" @bind:after="UpdateSchedulePreview" disabled="@isUploading" />
                                <div class="form-text">@scheduleSettings.Hours ì‹œê°„ ë™ì•ˆ ì—…ë¡œë“œ ë¶„ì‚°</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ìµœì†Œ ê°„ê²©: @scheduleSettings.MinIntervalMinutes ë¶„</label>
                                <input type="range" class="form-range" min="7" max="180" 
                                       @bind="scheduleSettings.MinIntervalMinutes" @bind:after="UpdateSchedulePreview" disabled="@isUploading" />
                                <div class="form-text">ì—…ë¡œë“œ ê°„ ìµœì†Œ @scheduleSettings.MinIntervalMinutes ë¶„ ê°„ê²©</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" @bind="scheduleSettings.RandomizeOrder" 
                                       @bind:after="UpdateSchedulePreview" id="randomizeOrder" disabled="@isUploading">
                                <label class="form-check-label" for="randomizeOrder">
                                    ì—…ë¡œë“œ ìˆœì„œ ëœë¤í™”
                                </label>
                            </div>
                        </div>

                        @if (schedulePreview.Count > 0 && selectedFiles.Count > 0)
                        {
                            <div class="alert alert-info">
                                <h6>ğŸ“… ì˜ˆìƒ ì—…ë¡œë“œ ìŠ¤ì¼€ì¤„:</h6>
                                <ul class="mb-0">
                                    @foreach (var item in schedulePreview.Take(5))
                                    {
                                        <li>ì˜ìƒ #@item.Index -> @item.ScheduledTime.ToString("MM/dd HH:mm")</li>
                                    }
                                    @if (schedulePreview.Count > 5)
                                    {
                                        <li>... ì´ @schedulePreview.Count ê°œ</li>
                                    }
                                </ul>
                            </div>
                        }
                    }
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
            <div class="d-grid gap-2 mb-3">
                <button type="button" class="btn btn-success btn-lg" @onclick="StartUpload" disabled="@(!CanUpload || isUploading)">
                    @if (isUploading)
                    {
                        <span>ì—…ë¡œë“œ ì¤‘...</span>
                    }
                    else
                    {
                        <span>@(isScheduleUpload ? "ìŠ¤ì¼€ì¤„ ì—…ë¡œë“œ ë“±ë¡" : "ì¦‰ì‹œ ì—…ë¡œë“œ")</span>
                    }
                </button>
            </div>

            <!-- ì§„í–‰ë¥  í‘œì‹œ -->
            @if (isUploading)
            {
                <div class="alert alert-info">
                    <div class="progress mb-2">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: @uploadProgress%"></div>
                    </div>
                    <div>@uploadStatus</div>
                </div>
            }

            <!-- ê²°ê³¼ í‘œì‹œ -->
            @if (!string.IsNullOrEmpty(uploadResult))
            {
                <div class="alert alert-success">
                    @uploadResult
                </div>
            }

            <!-- ìŠ¤ì¼€ì¤„ ìƒíƒœ í‘œì‹œ -->
            @if (!string.IsNullOrEmpty(scheduleStatus))
            {
                <div class="alert alert-info">
                    <strong>ìŠ¤ì¼€ì¤„ ìƒíƒœ:</strong> @scheduleStatus
                </div>
            }

        </div>
    </div>
</div>

<!-- ì—…ë¡œë“œ ì •ë³´ CSV ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
@if (showUploadInfoCsvPreview)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì—…ë¡œë“œ ì •ë³´ ë¯¸ë¦¬ë³´ê¸°</h5>
                    <button type="button" class="btn-close" @onclick="() => showUploadInfoCsvPreview = false"></button>
                </div>
                <div class="modal-body">
                    <p><strong>ì´ @uploadInfoCsvList.Count ê°œì˜ ì—…ë¡œë“œ ì •ë³´ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.</strong></p>
                    <div style="max-height: 400px; overflow-y: auto;">
                        @for (int i = 0; i < Math.Min(5, uploadInfoCsvList.Count); i++)
                        {
                            <div class="card mb-2">
                                <div class="card-body">
                                    <h6 class="card-title">@(i + 1). @uploadInfoCsvList[i].Title</h6>
                                    <p class="card-text small mb-1"><strong>ì„¤ëª…:</strong> @uploadInfoCsvList[i].Description</p>
                                    <p class="card-text small mb-0"><strong>íƒœê·¸:</strong> @uploadInfoCsvList[i].Tags</p>
                                </div>
                            </div>
                        }
                        @if (uploadInfoCsvList.Count > 5)
                        {
                            <div class="text-muted text-center">... ì™¸ @(uploadInfoCsvList.Count - 5) ê°œ ë”</div>
                        }
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="() => showUploadInfoCsvPreview = false">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    // ğŸ”¥ í†µí•© ì„œë¹„ìŠ¤ ì‚¬ìš©
    private YouTubeUploadService.UploadOptions uploadOptions = new();
    private UploadScheduleService.ScheduleSettings scheduleSettings = new();

    // íŒŒì¼ ê´€ë ¨
    private List<IBrowserFile> selectedFiles = new();

    // ì¸ì¦
    private bool isAuthenticating = false;

    // ì—…ë¡œë“œ ìƒíƒœ
    private bool isUploading = false;
    private int uploadProgress = 0;
    private string uploadStatus = "";
    private string uploadResult = "";

    // ìŠ¤ì¼€ì¤„ ê´€ë ¨
    private bool isScheduleUpload = false;
    private List<UploadScheduleService.SchedulePreviewItem> schedulePreview = new();
    private string scheduleStatus = "";

    // ëœë¤ ì—…ë¡œë“œ ì •ë³´
    private bool useRandomUploadInfo = false;
    private List<UploadInfoItem> uploadInfoCsvList = new();
    private bool showUploadInfoCsvPreview = false;

    public class UploadInfoItem
    {
        public string Title { get; set; } = "";
        public string Description { get; set; } = "";
        public string Tags { get; set; } = "";
    }

    private bool CanUpload
    {
        get
        {
            if (selectedFiles.Count == 0) return false;
            if (!YouTubeService.IsAuthenticated) return false;
            
            if (useRandomUploadInfo)
            {
                return uploadInfoCsvList.Count > 0;
            }
            else
            {
                return !string.IsNullOrWhiteSpace(uploadOptions.TitleTemplate);
            }
        }
    }

    protected override async Task OnInitializedAsync()
    {
       
        // ğŸ”¥ UserId ì´ˆê¸°í™” (ì¿ í‚¤ì—ì„œ ë¡œë“œ ë˜ëŠ” ìƒì„±) - ë§¨ ë¨¼ì € ì‹¤í–‰!
        await YouTubeService.InitializeAsync();
        
        // OAuth ì½œë°± ì²˜ë¦¬
        var uri = new Uri(await JSRuntime.InvokeAsync<string>("eval", "window.location.href"));
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        
        if (query["auth"] == "success")
        {
            await YouTubeService.CheckExistingAuthAsync();
            await JSRuntime.InvokeVoidAsync("alert", "YouTube ê³„ì • ì—°ë™ ì„±ê³µ!");
        }
        else if (query["auth"] == "error")
        {
            string message = query["message"] ?? "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";
            await JSRuntime.InvokeVoidAsync("alert", $"YouTube ê³„ì • ì—°ë™ ì‹¤íŒ¨: {message}");
        }

        StateHasChanged();
    }

    private async Task AuthenticateYouTube()
    {
        try
        {
            isAuthenticating = true;
            string authUrl = await YouTubeService.GetAuthorizationUrlAsync(JSRuntime, "youtube-upload");
            await JSRuntime.InvokeVoidAsync("open", authUrl, "_self");
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"ì¸ì¦ ì‹¤íŒ¨: {ex.Message}");
        }
        finally
        {
            isAuthenticating = false;
        }
    }

    private async Task SwitchAccount()
    {
        bool confirm = await JSRuntime.InvokeAsync<bool>("confirm", "ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (!confirm) return;
        
        await YouTubeService.SwitchAccountAsync();
        StateHasChanged();
        
        await AuthenticateYouTube();
    }

    private async Task HandleFileSelection(InputFileChangeEventArgs e)
    {
        selectedFiles = e.GetMultipleFiles(20).ToList();
        
        if (isScheduleUpload && selectedFiles.Count > 0)
        {
            UpdateSchedulePreview();
        }
        
        StateHasChanged();
    }

    private void OnRandomUploadInfoChanged()
    {
        if (!useRandomUploadInfo)
        {
            uploadInfoCsvList.Clear();
        }
    }

    private async Task HandleUploadInfoCsvSelection(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file == null) return;

        try
        {
            using var stream = file.OpenReadStream();
            using var reader = new StreamReader(stream);
            var content = await reader.ReadToEndAsync();

            uploadInfoCsvList = ParseUploadInfoCsv(content);
            StateHasChanged();
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"CSV íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: {ex.Message}");
        }
    }

    private List<UploadInfoItem> ParseUploadInfoCsv(string content)
    {
        var list = new List<UploadInfoItem>();
        var lines = content.Split('\n');

        foreach (var line in lines)
        {
            if (string.IsNullOrWhiteSpace(line)) continue;

            var parts = line.Split(',');
            if (parts.Length >= 3)
            {
                list.Add(new UploadInfoItem
                {
                    Title = parts[0].Trim(),
                    Description = parts[1].Trim(),
                    Tags = parts[2].Trim()
                });
            }
        }

        return list;
    }

    private void UpdateSchedulePreview()
    {
        if (selectedFiles.Count == 0) return;

        // ğŸ”¥ í†µí•© ì„œë¹„ìŠ¤ ì‚¬ìš©
        schedulePreview = SchedulerService.GenerateSchedulePreview(
            selectedFiles.Count,
            scheduleSettings
        );

        // Dictionaryë¡œ ë³€í™˜í•´ì„œ ì €ì¥
        scheduleSettings.ScheduledTimes = SchedulerService.ConvertPreviewToSchedule(schedulePreview);
        
        StateHasChanged();
    }

    // ğŸ”¥ ë©”ì¸ ì—…ë¡œë“œ ë¡œì§ - SchedulerService ì‚¬ìš©
    private async Task StartUpload()
    {
        // íŒŒì¼ì„ ì„ì‹œ ì €ì¥
        var filePaths = await SaveFilesToTemp();

        // ëœë¤ ì—…ë¡œë“œ ì •ë³´ ì„¤ì •
        if (useRandomUploadInfo && uploadInfoCsvList.Count > 0)
        {
            uploadOptions.UseRandomInfo = true;
            uploadOptions.RandomTitles = uploadInfoCsvList.Select(item => item.Title).ToList();
            uploadOptions.RandomDescriptions = uploadInfoCsvList.Select(item => item.Description).ToList();
            uploadOptions.RandomTags = uploadInfoCsvList.Select(item => item.Tags).ToList();
        }

        // ğŸ”¥ í†µí•© ì„œë¹„ìŠ¤ ìš”ì²­ ìƒì„±
        var request = new UploadScheduleService.UploadRequest
        {
            FilePaths = filePaths,
            UploadOptions = uploadOptions,
            IsScheduledUpload = isScheduleUpload,
            Schedule = scheduleSettings
        };

        // ê²€ì¦
        var validation = SchedulerService.ValidateUploadRequest(request);
        if (!validation.IsValid)
        {
            await JSRuntime.InvokeVoidAsync("alert", validation.ErrorMessage);
            return;
        }

        isUploading = true;
        uploadResult = "";

        try
        {
            if (isScheduleUpload)
            {
                // ğŸ”¥ ìŠ¤ì¼€ì¤„ ì—…ë¡œë“œ
                uploadStatus = "ìŠ¤ì¼€ì¤„ì— ë“±ë¡ ì¤‘...";
                uploadProgress = 50;
                StateHasChanged();

                SchedulerService.RegisterScheduledUpload(request);

                uploadProgress = 100;
                uploadStatus = "ìŠ¤ì¼€ì¤„ ë“±ë¡ ì™„ë£Œ";
                uploadResult = $"âœ… {selectedFiles.Count}ê°œ íŒŒì¼ì´ ìŠ¤ì¼€ì¤„ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!";
                scheduleStatus = SchedulerService.GetNextUploadInfo(userId);
            }
            else
            {
                // ğŸ”¥ ì¦‰ì‹œ ì—…ë¡œë“œ
                var results = await SchedulerService.UploadImmediatelyAsync(
                    request,
                    (current, total, fileName) => {
                        uploadProgress = (current * 100 / total);
                        uploadStatus = $"ì—…ë¡œë“œ ì¤‘... ({current}/{total}) {fileName}";
                        StateHasChanged();
                    }
                );

                int successCount = results.Count(r => r.Success);
                uploadResult = $"âœ… ì´ {results.Count}ê°œ ì¤‘ {successCount}ê°œ ì—…ë¡œë“œ ì™„ë£Œ!";
            }
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"ì—…ë¡œë“œ ì˜¤ë¥˜: {ex.Message}");
            uploadResult = $"âŒ ì˜¤ë¥˜ ë°œìƒ: {ex.Message}";
        }
        finally
        {
            isUploading = false;
            StateHasChanged();
        }
    }

    private async Task<List<string>> SaveFilesToTemp()
    {
        var filePaths = new List<string>();

        for (int i = 0; i < selectedFiles.Count; i++)
        {
            var file = selectedFiles[i];
            string tempPath = Path.Combine(Path.GetTempPath(), $"{DateTime.Now.Ticks}_{file.Name}");

            uploadStatus = $"íŒŒì¼ ì¤€ë¹„ ì¤‘... ({i + 1}/{selectedFiles.Count})";
            uploadProgress = (i * 20 / selectedFiles.Count);
            StateHasChanged();

            using (var fileStream = new FileStream(tempPath, FileMode.Create))
            {
                await file.OpenReadStream(maxAllowedSize: 2L * 1024 * 1024 * 1024).CopyToAsync(fileStream);
            }

            filePaths.Add(tempPath);
        }

        return filePaths;
    }
}
